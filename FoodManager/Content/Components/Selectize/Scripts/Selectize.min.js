!function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():t.Sifter=e()}(this,function(){var t=function(t,e){this.items=t,this.settings=e||{diacritics:!0}};t.prototype.tokenize=function(t){if(t=i(String(t||"").toLowerCase()),!t||!t.length)return[];var e,n,s,a,l=[],u=t.split(/ +/);for(e=0,n=u.length;n>e;e++){if(s=o(u[e]),this.settings.diacritics)for(a in r)r.hasOwnProperty(a)&&(s=s.replace(new RegExp(a,"g"),r[a]));l.push({string:u[e],regex:new RegExp(s,"i")})}return l},t.prototype.iterator=function(t,e){var n;n=s(t)?Array.prototype.forEach||function(t){for(var e=0,n=this.length;n>e;e++)t(this[e],e,this)}:function(t){for(var e in this)this.hasOwnProperty(e)&&t(this[e],e,this)},n.apply(t,[e])},t.prototype.getScoreFunction=function(t,e){var n,i,o,s;n=this,t=n.prepareSearch(t,e),o=t.tokens,i=t.options.fields,s=o.length;var r=function(t,e){var n,i;return t?(t=String(t||""),i=t.search(e.regex),-1===i?0:(n=e.string.length/t.length,0===i&&(n+=.5),n)):0},a=function(){var t=i.length;return t?1===t?function(t,e){return r(e[i[0]],t)}:function(e,n){for(var o=0,s=0;t>o;o++)s+=r(n[i[o]],e);return s/t}:function(){return 0}}();return s?1===s?function(t){return a(o[0],t)}:function(t){for(var e=0,n=0;s>e;e++)n+=a(o[e],t);return n/s}:function(){return 0}},t.prototype.prepareSearch=function(t,e){return"object"==typeof t?t:{options:n({},e),query:String(t||"").toLowerCase(),tokens:this.tokenize(t),total:0,items:[]}},t.prototype.search=function(t,n){var i,o,r,a=this;return o=this.prepareSearch(t,n),n=o.options,t=o.query,s(n.fields)||(n.fields=[n.fields]),r=n.score||a.getScoreFunction(o),t.length?(a.iterator(a.items,function(t,e){i=r(t),i>0&&o.items.push({score:i,id:e})}),o.items.sort(function(t,e){return e.score-t.score})):(a.iterator(a.items,function(t,e){o.items.push({score:1,id:e})}),n.sort&&o.items.sort(function(){var t=n.sort,i="desc"===n.direction?-1:1;return function(n,o){return e(a.items[n.id][t],a.items[o.id][t])*i}}())),o.total=o.items.length,"number"==typeof n.limit&&(o.items=o.items.slice(0,n.limit)),o};var e=function(t,e){return"number"==typeof t&&"number"==typeof e?t>e?1:e>t?-1:0:(t=String(t||"").toLowerCase(),e=String(e||"").toLowerCase(),t>e?1:e>t?-1:0)},n=function(t){var e,n,i,o;for(e=1,n=arguments.length;n>e;e++)if(o=arguments[e])for(i in o)o.hasOwnProperty(i)&&(t[i]=o[i]);return t},i=function(t){return(t+"").replace(/^\s+|\s+$|/g,"")},o=function(t){return(t+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1")},s=Array.isArray||$&&$.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},r={a:"[aÀÁÂÃÄÅàáâãäå]",c:"[cÇç]",e:"[eÈÉÊËèéêë]",i:"[iÌÍÎÏìíîï]",n:"[nÑñ]",o:"[oÒÓÔÕÕÖØòóôõöø]",s:"[sŠš]",u:"[uÙÚÛÜùúûü]",y:"[yŸÿý]",z:"[zŽž]"};return t}),function(t,e){"function"==typeof define&&define.amd?define(e):"object"==typeof exports?module.exports=e():t.MicroPlugin=e()}(this,function(){var t={};t.mixin=function(t){t.plugins={},t.prototype.initializePlugins=function(t){var n,i,o,s=this,r=[];if(s.plugins={names:[],settings:{},requested:{},loaded:{}},e.isArray(t))for(n=0,i=t.length;i>n;n++)"string"==typeof t[n]?r.push(t[n]):(s.plugins.settings[t[n].name]=t[n].options,r.push(t[n].name));else if(t)for(o in t)t.hasOwnProperty(o)&&(s.plugins.settings[o]=t[o],r.push(o));for(;r.length;)s.require(r.shift())},t.prototype.loadPlugin=function(e){var n=this,i=n.plugins,o=t.plugins[e];if(!t.plugins.hasOwnProperty(e))throw new Error('Unable to find "'+e+'" plugin');i.requested[e]=!0,i.loaded[e]=o.fn.apply(n,[n.plugins.settings[e]||{}]),i.names.push(e)},t.prototype.require=function(t){var e=this,n=e.plugins;if(!e.plugins.loaded.hasOwnProperty(t)){if(n.requested[t])throw new Error('Plugin has circular dependency ("'+t+'")');e.loadPlugin(t)}return n.loaded[t]},t.define=function(e,n){t.plugins[e]={name:e,fn:n}}};var e={isArray:Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)}};return t}),function(t,e){"function"==typeof define&&define.amd?define(["jquery","sifter","microplugin"],e):t.Selectize=e(t.jQuery,t.Sifter,t.MicroPlugin)}(this,function(t,e,n){"use strict";var i=function(t,e){if("string"!=typeof e||e.length){var n="string"==typeof e?new RegExp(e,"i"):e,i=function(t){var e=0;if(3===t.nodeType){var o=t.data.search(n);if(o>=0&&t.data.length>0){var s=t.data.match(n),r=document.createElement("span");r.className="highlight";var a=t.splitText(o),l=(a.splitText(s[0].length),a.cloneNode(!0));r.appendChild(l),a.parentNode.replaceChild(r,a),e=1}}else if(1===t.nodeType&&t.childNodes&&!/(script|style)/i.test(t.tagName))for(var u=0;u<t.childNodes.length;++u)u+=i(t.childNodes[u]);return e};return t.each(function(){i(this)})}},o=function(){};o.prototype={on:function(t,e){this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(e)},off:function(t,e){var n=arguments.length;return 0===n?delete this._events:1===n?delete this._events[t]:(this._events=this._events||{},void(t in this._events!=!1&&this._events[t].splice(this._events[t].indexOf(e),1)))},trigger:function(t){if(this._events=this._events||{},t in this._events!=!1)for(var e=0;e<this._events[t].length;e++)this._events[t][e].apply(this,Array.prototype.slice.call(arguments,1))}},o.mixin=function(t){for(var e=["on","off","trigger"],n=0;n<e.length;n++)t.prototype[e[n]]=o.prototype[e[n]]};var s=/Mac/.test(navigator.userAgent),r=65,a=13,l=27,u=37,p=38,c=39,d=40,h=8,g=46,f=16,v=s?91:17,m=s?18:17,y=9,w=32,O=1,$=2,C=function(t){return"undefined"!=typeof t},b=function(t){return"undefined"==typeof t||null===t?"":"boolean"==typeof t?t?"1":"0":t+""},I=function(t){return(t+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},x={};x.before=function(t,e,n){var i=t[e];t[e]=function(){return n.apply(t,arguments),i.apply(t,arguments)}},x.after=function(t,e,n){var i=t[e];t[e]=function(){var e=i.apply(t,arguments);return n.apply(t,arguments),e}};var _=function(e,n){if(!t.isArray(n))return n;var i,o,s={};for(i=0,o=n.length;o>i;i++)n[i].hasOwnProperty(e)&&(s[n[i][e]]=n[i]);return s},S=function(t){var e=!1;return function(){e||(e=!0,t.apply(this,arguments))}},F=function(t,e){var n;return function(){var i=this,o=arguments;window.clearTimeout(n),n=window.setTimeout(function(){t.apply(i,o)},e)}},D=function(t,e,n){var i,o=t.trigger,s={};t.trigger=function(){var n=arguments[0];return-1===e.indexOf(n)?o.apply(t,arguments):void(s[n]=arguments)},n.apply(t,[]),t.trigger=o;for(i in s)s.hasOwnProperty(i)&&o.apply(t,s[i])},A=function(t,e,n,i){t.on(e,n,function(e){for(var n=e.target;n&&n.parentNode!==t[0];)n=n.parentNode;return e.currentTarget=n,i.apply(this,[e])})},k=function(t){var e={};if("selectionStart"in t)e.start=t.selectionStart,e.length=t.selectionEnd-e.start;else if(document.selection){t.focus();var n=document.selection.createRange(),i=document.selection.createRange().text.length;n.moveStart("character",-t.value.length),e.start=n.text.length-i,e.length=i}return e},P=function(t,e,n){var i,o,s={};if(n)for(i=0,o=n.length;o>i;i++)s[n[i]]=t.css(n[i]);else s=t.css();e.css(s)},z=function(e,n){var i=t("<test>").css({position:"absolute",top:-99999,left:-99999,width:"auto",padding:0,whiteSpace:"nowrap"}).text(e).appendTo("body");P(n,i,["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"]);var o=i.width();return i.remove(),o},T=function(t){var e=function(e){var n,i,o,s,r,a,l,u;e=e||window.event||{},e.metaKey||e.altKey||t.data("grow")!==!1&&(n=t.val(),e.type&&"keydown"===e.type.toLowerCase()&&(i=e.keyCode,o=i>=97&&122>=i||i>=65&&90>=i||i>=48&&57>=i||32===i,i===g||i===h?(u=k(t[0]),u.length?n=n.substring(0,u.start)+n.substring(u.start+u.length):i===h&&u.start?n=n.substring(0,u.start-1)+n.substring(u.start+1):i===g&&"undefined"!=typeof u.start&&(n=n.substring(0,u.start)+n.substring(u.start+1))):o&&(a=e.shiftKey,l=String.fromCharCode(e.keyCode),l=a?l.toUpperCase():l.toLowerCase(),n+=l)),s=t.attr("placeholder")||"",!n.length&&s.length&&(n=s),r=z(n,t)+4,r!==t.width()&&(t.width(r),t.triggerHandler("resize")))};t.on("keydown keyup update blur",e),e()},j=function(n,i){var o=this;n[0].selectize=o,t.extend(o,{settings:i,$input:n,tagType:"select"===n[0].tagName.toLowerCase()?O:$,eventNS:".selectize"+ ++j.count,highlightedValue:null,isOpen:!1,isDisabled:!1,isLocked:!1,isFocused:!1,isInputFocused:!1,isInputHidden:!1,isSetup:!1,isShiftDown:!1,isCmdDown:!1,isCtrlDown:!1,ignoreFocus:!1,ignoreHover:!1,hasOptions:!1,currentResults:null,lastValue:"",caretPos:0,loading:0,loadedSearches:{},$activeOption:null,$activeItems:[],optgroups:{},options:{},userOptions:{},items:[],renderCache:{},onSearchChange:F(o.onSearchChange,i.loadThrottle)}),o.sifter=new e(this.options,{diacritics:i.diacritics}),t.extend(o.options,_(i.valueField,i.options)),delete o.settings.options,t.extend(o.optgroups,_(i.optgroupValueField,i.optgroups)),delete o.settings.optgroups,o.settings.mode=o.settings.mode||(1===o.settings.maxItems?"single":"multi"),"boolean"!=typeof o.settings.hideSelected&&(o.settings.hideSelected="multi"===o.settings.mode),o.initializePlugins(o.settings.plugins),o.setupCallbacks(),o.setupTemplates(),o.setup()};return o.mixin(j),n.mixin(j),t.extend(j.prototype,{setup:function(){var e,n,i,o,r,a,l,u,p,c,d=this,h=d.settings,g=d.eventNS,y=t(window),w=t(document);l=d.settings.mode,u=d.$input.attr("tabindex")||"",p=d.$input.attr("class")||"",e=t("<div>").addClass(h.wrapperClass).addClass(p).addClass(l),n=t("<div>").addClass(h.inputClass).addClass("items").appendTo(e),i=t('<input type="text">').appendTo(n).attr("tabindex",u),a=t(h.dropdownParent||e),o=t("<div>").addClass(h.dropdownClass).addClass(p).addClass(l).hide().appendTo(a),r=t("<div>").addClass(h.dropdownContentClass).appendTo(o),e.css({width:d.$input[0].style.width}),d.plugins.names.length&&(c="plugin-"+d.plugins.names.join(" plugin-"),e.addClass(c),o.addClass(c)),(null===h.maxItems||h.maxItems>1)&&d.tagType===O&&d.$input.attr("multiple","multiple"),d.settings.placeholder&&i.attr("placeholder",h.placeholder),d.$wrapper=e,d.$control=n,d.$control_input=i,d.$dropdown=o,d.$dropdown_content=r,n.on("mousedown",function(t){t.isDefaultPrevented()||window.setTimeout(function(){d.focus(!0)},0)}),n.on("click",function(){d.isInputFocused||d.focus(!0)}),o.on("mouseenter","[data-selectable]",function(){return d.onOptionHover.apply(d,arguments)}),o.on("mousedown","[data-selectable]",function(){return d.onOptionSelect.apply(d,arguments)}),A(n,"mousedown","*:not(input)",function(){return d.onItemSelect.apply(d,arguments)}),T(i),i.on({mousedown:function(t){t.stopPropagation()},keydown:function(){return d.onKeyDown.apply(d,arguments)},keyup:function(){return d.onKeyUp.apply(d,arguments)},keypress:function(){return d.onKeyPress.apply(d,arguments)},resize:function(){d.positionDropdown.apply(d,[])},blur:function(){return d.onBlur.apply(d,arguments)},focus:function(){return d.onFocus.apply(d,arguments)}}),w.on("keydown"+g,function(t){d.isCmdDown=t[s?"metaKey":"ctrlKey"],d.isCtrlDown=t[s?"altKey":"ctrlKey"],d.isShiftDown=t.shiftKey}),w.on("keyup"+g,function(t){t.keyCode===m&&(d.isCtrlDown=!1),t.keyCode===f&&(d.isShiftDown=!1),t.keyCode===v&&(d.isCmdDown=!1)}),w.on("mousedown"+g,function(t){if(d.isFocused){if(t.target===d.$dropdown[0]||t.target.parentNode===d.$dropdown[0]){var e=d.ignoreFocus;return d.ignoreFocus=!0,void window.setTimeout(function(){d.ignoreFocus=e,d.focus(!1)},0)}d.$control.has(t.target).length||t.target===d.$control[0]||d.blur()}}),y.on(["scroll"+g,"resize"+g].join(" "),function(){d.isOpen&&d.positionDropdown.apply(d,arguments)}),y.on("mousemove"+g,function(){d.ignoreHover=!1}),d.$input.attr("tabindex",-1).hide().after(d.$wrapper),t.isArray(h.items)&&(d.setValue(h.items),delete h.items),d.updateOriginalInput(),d.refreshItems(),d.refreshClasses(),d.updatePlaceholder(),d.isSetup=!0,d.$input.is(":disabled")&&d.disable(),d.on("change",this.onChange),d.trigger("initialize"),h.preload&&d.onSearchChange("")},setupTemplates:function(){var e=this,n=e.settings.labelField,i=e.settings.optgroupLabelField,o={optgroup:function(t){return'<div class="optgroup">'+t.html+"</div>"},optgroup_header:function(t,e){return'<div class="optgroup-header">'+e(t[i])+"</div>"},option:function(t,e){return'<div class="option">'+e(t[n])+"</div>"},item:function(t,e){return'<div class="item">'+e(t[n])+"</div>"},option_create:function(t,e){return'<div class="create" style="color:black;">Agregar hashtag <strong>'+e(t.input)+"</strong>&hellip;</div>"}};e.settings.render=t.extend({},o,e.settings.render)},setupCallbacks:function(){var t,e,n={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType"};for(t in n)n.hasOwnProperty(t)&&(e=this.settings[n[t]],e&&this.on(t,e))},onChange:function(){this.$input.trigger("change")},onKeyPress:function(t){if(this.isLocked)return t&&t.preventDefault();var e=String.fromCharCode(t.keyCode||t.which);return this.settings.create&&e===this.settings.delimiter?(this.createItem(),t.preventDefault(),!1):void 0},onKeyDown:function(e){var n=(e.target===this.$control_input[0],this);if(n.isLocked)return void(e.keyCode!==y&&e.preventDefault());switch(e.keyCode){case r:if(n.isCmdDown)return void n.selectAll();break;case l:return void n.blur();case d:if(!n.isOpen&&n.hasOptions)n.open();else if(n.$activeOption){n.ignoreHover=!0;var i=n.getAdjacentOption(n.$activeOption,1);i.length&&n.setActiveOption(i,!0,!0)}return void e.preventDefault();case p:if(n.$activeOption){n.ignoreHover=!0;var o=n.getAdjacentOption(n.$activeOption,-1);o.length&&n.setActiveOption(o,!0,!0)}return void e.preventDefault();case a:return n.$activeOption&&n.onOptionSelect({currentTarget:n.$activeOption}),void e.preventDefault();case u:return void n.advanceSelection(-1,e);case c:return void n.advanceSelection(1,e);case y:return n.settings.create&&t.trim(n.$control_input.val()).length?(n.createItem(),e.preventDefault()):n.$activeOption&&n.onOptionSelect({currentTarget:n.$activeOption}),void e.preventDefault();case w:return void(n.settings.create&&t.trim(n.$control_input.val()).length&&(n.createItem(),e.preventDefault()));case h:case g:return void n.deleteSelection(e)}return n.isFull()||n.isInputHidden?void e.preventDefault():void 0},onKeyUp:function(t){var e=this;if(e.isLocked)return t&&t.preventDefault();var n=e.$control_input.val()||"";e.lastValue!==n&&(e.lastValue=n,e.onSearchChange(n),e.refreshOptions(),e.trigger("type",n))},onSearchChange:function(t){var e=this,n=e.settings.load;n&&(e.loadedSearches.hasOwnProperty(t)||(e.loadedSearches[t]=!0,e.load(function(i){n.apply(e,[t,i])})))},onFocus:function(t){var e=this;return e.isInputFocused=!0,e.isFocused=!0,e.isDisabled?(e.blur(),t.preventDefault(),!1):void(e.ignoreFocus||("focus"===e.settings.preload&&e.onSearchChange(""),e.showInput(),e.setActiveItem(null),e.refreshOptions(!!e.settings.openOnFocus),e.refreshClasses()))},onBlur:function(){var t=this;t.isInputFocused=!1,t.ignoreFocus||(t.close(),t.setTextboxValue(""),t.setActiveItem(null),t.setActiveOption(null),t.setCaret(t.items.length),t.isFocused=!1,t.refreshClasses())},onOptionHover:function(t){this.ignoreHover||this.setActiveOption(t.currentTarget,!1)},onOptionSelect:function(e){var n,i,o=this;e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),o.focus(!1),i=t(e.currentTarget),i.hasClass("create")?o.createItem():(n=i.attr("data-value"),n&&(o.setTextboxValue(""),o.addItem(n),!o.settings.hideSelected&&e.type&&/mouse/.test(e.type)&&o.setActiveOption(o.getOption(n))))},onItemSelect:function(t){var e=this;"multi"===e.settings.mode&&(t.preventDefault(),e.setActiveItem(t.currentTarget,t),e.focus(!1),e.hideInput())},load:function(t){var e=this,n=e.$wrapper.addClass("loading");e.loading++,t.apply(e,[function(t){e.loading=Math.max(e.loading-1,0),t&&t.length&&(e.addOption(t),e.refreshOptions(!1),e.isInputFocused&&e.open()),e.loading||n.removeClass("loading"),e.trigger("load",t)}])},setTextboxValue:function(t){this.$control_input.val(t).triggerHandler("update"),this.lastValue=t},getValue:function(){return this.tagType===O&&this.$input.attr("multiple")?this.items:this.items.join(this.settings.delimiter)},setValue:function(e){D(this,["change"],function(){this.clear();for(var n=t.isArray(e)?e:[e],i=0,o=n.length;o>i;i++)this.addItem(n[i])})},setActiveItem:function(e,n){var i,o,s,r,a,l,u,p,c=this;if(e=t(e),!e.length)return t(c.$activeItems).removeClass("active"),c.$activeItems=[],void(c.isFocused=c.isInputFocused);if(i=n&&n.type.toLowerCase(),"mousedown"===i&&c.isShiftDown&&c.$activeItems.length){for(p=c.$control.children(".active:last"),r=Array.prototype.indexOf.apply(c.$control[0].childNodes,[p[0]]),a=Array.prototype.indexOf.apply(c.$control[0].childNodes,[e[0]]),r>a&&(u=r,r=a,a=u),o=r;a>=o;o++)l=c.$control[0].childNodes[o],-1===c.$activeItems.indexOf(l)&&(t(l).addClass("active"),c.$activeItems.push(l));n.preventDefault()}else"mousedown"===i&&c.isCtrlDown||"keydown"===i&&this.isShiftDown?e.hasClass("active")?(s=c.$activeItems.indexOf(e[0]),c.$activeItems.splice(s,1),e.removeClass("active")):c.$activeItems.push(e.addClass("active")[0]):(t(c.$activeItems).removeClass("active"),c.$activeItems=[e.addClass("active")[0]]);c.isFocused=!!c.$activeItems.length||c.isInputFocused},setActiveOption:function(e,n,i){var o,s,r,a,l,u=this;u.$activeOption&&u.$activeOption.removeClass("active"),u.$activeOption=null,e=t(e),e.length&&(u.$activeOption=e.addClass("active"),(n||!C(n))&&(o=u.$dropdown_content.height(),s=u.$activeOption.outerHeight(!0),n=u.$dropdown_content.scrollTop()||0,r=u.$activeOption.offset().top-u.$dropdown_content.offset().top+n,a=r,l=r-o+s,r+s>o-n?u.$dropdown_content.stop().animate({scrollTop:l},i?u.settings.scrollDuration:0):n>r&&u.$dropdown_content.stop().animate({scrollTop:a},i?u.settings.scrollDuration:0)))},selectAll:function(){this.$activeItems=Array.prototype.slice.apply(this.$control.children(":not(input)").addClass("active")),this.isFocused=!0,this.$activeItems.length&&this.hideInput()},hideInput:function(){var t=this;t.close(),t.setTextboxValue(""),t.$control_input.css({opacity:0,position:"absolute",left:-1e4}),t.isInputHidden=!0},showInput:function(){this.$control_input.css({opacity:1,position:"relative",left:0}),this.isInputHidden=!1},focus:function(t){var e=this;e.isDisabled||(e.ignoreFocus=!0,e.$control_input[0].focus(),e.isInputFocused=!0,window.setTimeout(function(){e.ignoreFocus=!1,t&&e.onFocus()},0))},blur:function(){this.$control_input.trigger("blur")},getScoreFunction:function(t){return this.sifter.getScoreFunction(t,this.getSearchOptions())},getSearchOptions:function(){var e=this.settings,n=e.searchField;return{fields:t.isArray(n)?n:[n],sort:e.sortField,direction:e.sortDirection}},search:function(e){var n,i,o,s=this,r=s.settings,a=this.getSearchOptions();if(r.score&&(o=s.settings.score.apply(this,[e]),"function"!=typeof o))throw new Error('Selectize "score" setting must be a function that returns a function');if(e!==s.lastQuery?(s.lastQuery=e,i=s.sifter.search(e,t.extend(a,{score:o})),s.currentResults=i):i=t.extend(!0,{},s.currentResults),r.hideSelected)for(n=i.items.length-1;n>=0;n--)-1!==s.items.indexOf(b(i.items[n].id))&&i.items.splice(n,1);return i},refreshOptions:function(e){"undefined"==typeof e&&(e=!0);var n,o,s,r,a,l,u,p,c,d,h,g=this,f=g.$control_input.val(),v=g.search(f),m=g.$dropdown_content;if(o=v.items.length,"number"==typeof g.settings.maxOptions&&(o=Math.min(o,g.settings.maxOptions)),s={},g.settings.optgroupOrder)for(r=g.settings.optgroupOrder,n=0;n<r.length;n++)s[r[n]]=[];else r=[];for(n=0;o>n;n++)a=g.options[v.items[n].id],l=a[g.settings.optgroupField]||"",g.optgroups.hasOwnProperty(l)||(l=""),s.hasOwnProperty(l)||(s[l]=[],r.push(l)),s[l].push(g.render("option",a));for(u=[],n=0,o=r.length;o>n;n++)l=r[n],g.optgroups.hasOwnProperty(l)&&s[l].length?(p=g.render("optgroup_header",g.optgroups[l])||"",p+=s[l].join(""),u.push(g.render("optgroup",t.extend({},g.optgroups[l],{html:p})))):u.push(s[l].join(""));if(m.html(u.join("")),g.settings.highlight&&v.query.length&&v.tokens.length)for(n=0,o=v.tokens.length;o>n;n++)i(m,v.tokens[n].regex);if(!g.settings.hideSelected)for(n=0,o=g.items.length;o>n;n++)g.getOption(g.items[n]).addClass("selected");c=g.settings.create&&v.query.length,c&&(m.prepend(g.render("option_create",{input:f})),h=t(m[0].childNodes[0])),g.hasOptions=v.items.length>0||c,g.hasOptions?(d=v.items.length>0?h?g.getAdjacentOption(h,1):m.find("[data-selectable]").first():h,g.setActiveOption(d),e&&!g.isOpen&&g.open()):(g.setActiveOption(null),e&&g.isOpen&&g.close())},addOption:function(e){var n,i,o,s=this;if(t.isArray(e))for(n=0,i=e.length;i>n;n++)s.addOption(e[n]);else o=b(e[s.settings.valueField]),o&&!s.options.hasOwnProperty(o)&&(s.userOptions[o]=!0,s.options[o]=e,s.lastQuery=null,s.trigger("option_add",o,e))},addOptionGroup:function(t,e){this.optgroups[t]=e,this.trigger("optgroup_add",t,e)},updateOption:function(e,n){var i,o,s,r,a,l,u=this;if(e=b(e),s=b(n[u.settings.valueField]),u.options.hasOwnProperty(e)){if(!s)throw new Error("Value must be set in option data");s!==e&&(delete u.options[e],r=u.items.indexOf(e),-1!==r&&u.items.splice(r,1,s)),u.options[s]=n,a=u.renderCache.item,l=u.renderCache.option,C(a)&&(delete a[e],delete a[s]),C(l)&&(delete l[e],delete l[s]),-1!==u.items.indexOf(s)&&(i=u.getItem(e),o=t(u.render("item",n)),i.hasClass("active")&&o.addClass("active"),i.replaceWith(o)),u.isOpen&&u.refreshOptions(!1)}},removeOption:function(t){var e=this;t=b(t),delete e.userOptions[t],delete e.options[t],e.lastQuery=null,e.trigger("option_remove",t),e.removeItem(t)},clearOptions:function(){var t=this;t.loadedSearches={},t.userOptions={},t.options=t.sifter.items={},t.lastQuery=null,t.trigger("option_clear"),t.clear()},getOption:function(t){return this.getElementWithValue(t,this.$dropdown_content.find("[data-selectable]"))},getAdjacentOption:function(e,n){var i=this.$dropdown.find("[data-selectable]"),o=i.index(e)+n;return o>=0&&o<i.length?i.eq(o):t()},getElementWithValue:function(e,n){if(e=b(e))for(var i=0,o=n.length;o>i;i++)if(n[i].getAttribute("data-value")===e)return t(n[i]);return t()},getItem:function(t){return this.getElementWithValue(t,this.$control.children())},addItem:function(e){D(this,["change"],function(){var n,i,o,s,r=this,a=r.settings.mode;e=b(e),"single"===a&&r.clear(),"multi"===a&&r.isFull()||-1===r.items.indexOf(e)&&r.options.hasOwnProperty(e)&&(n=t(r.render("item",r.options[e])),r.items.splice(r.caretPos,0,e),r.insertAtCaret(n),r.refreshClasses(),r.isSetup&&(o=r.$dropdown_content.find("[data-selectable]"),i=r.getOption(e),s=r.getAdjacentOption(i,1).attr("data-value"),r.refreshOptions(r.isFocused&&"single"!==a),s&&r.setActiveOption(r.getOption(s)),!o.length||null!==r.settings.maxItems&&r.items.length>=r.settings.maxItems?r.close():r.positionDropdown(),r.isFocused&&window.setTimeout(function(){"single"===a?(r.blur(),r.focus(!1),r.hideInput()):r.focus(!1)},0),r.updatePlaceholder(),r.trigger("item_add",e,n),r.updateOriginalInput()))})},removeItem:function(t){var e,n,i,o=this;e="object"==typeof t?t:o.getItem(t),t=b(e.attr("data-value")),n=o.items.indexOf(t),-1!==n&&(e.remove(),e.hasClass("active")&&(i=o.$activeItems.indexOf(e[0]),o.$activeItems.splice(i,1)),o.items.splice(n,1),o.lastQuery=null,!o.settings.persist&&o.userOptions.hasOwnProperty(t)&&o.removeOption(t),n<o.caretPos&&o.setCaret(o.caretPos-1),o.refreshClasses(),o.updatePlaceholder(),o.updateOriginalInput(),o.positionDropdown(),o.trigger("item_remove",t))},createItem:function(){var e=this,n=t.trim(e.$control_input.val()||""),i=e.caretPos;if(n.length){e.lock();var o="function"==typeof e.settings.create?this.settings.create:function(t){var n={};return n[e.settings.labelField]=t,n[e.settings.valueField]=t,n},s=S(function(t){if(e.unlock(),e.focus(!1),t&&"object"==typeof t){var n=b(t[e.settings.valueField]);n&&(e.setTextboxValue(""),e.addOption(t),e.setCaret(i),e.addItem(n),e.refreshOptions("single"!==e.settings.mode),e.focus(!1))}}),r=o.apply(this,[n,s]);"undefined"!=typeof r&&s(r)}},refreshItems:function(){if(this.lastQuery=null,this.isSetup)for(var t=0;t<this.items.length;t++)this.addItem(this.items);this.refreshClasses(),this.updateOriginalInput()},refreshClasses:function(){var e=this,n=e.isFull(),i=e.isLocked;this.$control.toggleClass("focus",e.isFocused).toggleClass("disabled",e.isDisabled).toggleClass("locked",i).toggleClass("full",n).toggleClass("not-full",!n).toggleClass("dropdown-active",e.isOpen).toggleClass("has-options",!t.isEmptyObject(e.options)).toggleClass("has-items",e.items.length>0),this.$control_input.data("grow",!n&&!i)},isFull:function(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems},updateOriginalInput:function(){var t,e,n,i=this;if("select"===i.$input[0].tagName.toLowerCase()){for(n=[],t=0,e=i.items.length;e>t;t++)n.push('<option value="'+I(i.items[t])+'" selected="selected"></option>');n.length||this.$input.attr("multiple")||n.push('<option value="" selected="selected"></option>'),i.$input.html(n.join(""))}else i.$input.val(i.getValue());i.isSetup&&i.trigger("change",i.$input.val())},updatePlaceholder:function(){if(this.settings.placeholder){var t=this.$control_input;this.items.length?t.removeAttr("placeholder"):t.attr("placeholder",this.settings.placeholder),t.triggerHandler("update")}},open:function(){var t=this;t.isLocked||t.isOpen||"multi"===t.settings.mode&&t.isFull()||(t.focus(!0),t.isOpen=!0,t.refreshClasses(),t.$dropdown.css({visibility:"hidden",display:"block"}),t.positionDropdown(),t.$dropdown.css({visibility:"visible"}),t.trigger("dropdown_open",this.$dropdown))},close:function(){var t=this;t.isOpen&&(t.$dropdown.hide(),t.setActiveOption(null),t.isOpen=!1,t.refreshClasses(),t.trigger("dropdown_close",t.$dropdown))},positionDropdown:function(){var t=this.$control,e="body"===this.settings.dropdownParent?t.offset():t.position();e.top+=t.outerHeight(!0),this.$dropdown.css({width:t.outerWidth(),top:e.top,left:e.left})},clear:function(){var t=this;t.items.length&&(t.$control.children(":not(input)").remove(),t.items=[],t.setCaret(0),t.updatePlaceholder(),t.updateOriginalInput(),t.refreshClasses(),t.showInput(),t.trigger("clear"))},insertAtCaret:function(e){var n=Math.min(this.caretPos,this.items.length);0===n?this.$control.prepend(e):t(this.$control[0].childNodes[n]).before(e),this.setCaret(n+1)},deleteSelection:function(e){var n,i,o,s,r,a,l,u,p,c=this;if(o=e&&e.keyCode===h?-1:1,s=k(c.$control_input[0]),c.$activeOption&&!c.settings.hideSelected&&(l=c.getAdjacentOption(c.$activeOption,-1).attr("data-value")),r=[],c.$activeItems.length){for(p=c.$control.children(".active:"+(o>0?"last":"first")),a=c.$control.children(":not(input)").index(p),o>0&&a++,n=0,i=c.$activeItems.length;i>n;n++)r.push(t(c.$activeItems[n]).attr("data-value"));e&&(e.preventDefault(),e.stopPropagation())}else(c.isFocused||"single"===c.settings.mode)&&c.items.length&&(0>o&&0===s.start&&0===s.length?r.push(c.items[c.caretPos-1]):o>0&&s.start===c.$control_input.val().length&&r.push(c.items[c.caretPos]));if(!r.length||"function"==typeof c.settings.onDelete&&c.settings.onDelete.apply(c,[r])===!1)return!1;for("undefined"!=typeof a&&c.setCaret(a);r.length;)c.removeItem(r.pop());return c.showInput(),c.refreshOptions(!0),l&&(u=c.getOption(l),u.length&&c.setActiveOption(u)),!0},advanceSelection:function(t,e){var n,i,o,s,r,a,l=this;0!==t&&(n=t>0?"last":"first",i=k(l.$control_input[0]),l.isInputFocused&&!l.isInputHidden?(s=l.$control_input.val().length,r=0>t?0===i.start&&0===i.length:i.start===s,r&&!s&&l.advanceCaret(t,e)):(a=l.$control.children(".active:"+n),a.length&&(o=l.$control.children(":not(input)").index(a),l.setActiveItem(null),l.setCaret(t>0?o+1:o),l.showInput())))},advanceCaret:function(t,e){if(0!==t){var n=this,i=t>0?"next":"prev";if(n.isShiftDown){var o=n.$control_input[i]();o.length&&(n.hideInput(),n.setActiveItem(o),e&&e.preventDefault())}else n.setCaret(n.caretPos+t)}},setCaret:function(e){var n=this;e="single"===n.settings.mode?n.items.length:Math.max(0,Math.min(n.items.length,e));var i,o,s,r;for(s=n.$control.children(":not(input)"),i=0,o=s.length;o>i;i++)r=t(s[i]).detach(),e>i?n.$control_input.before(r):n.$control.append(r);n.caretPos=e},lock:function(){this.close(),this.isLocked=!0,this.refreshClasses()},unlock:function(){this.isLocked=!1,this.refreshClasses()},disable:function(){var t=this;t.$input.prop("disabled",!0),t.isDisabled=!0,t.lock()},enable:function(){var t=this;t.$input.prop("disabled",!1),t.isDisabled=!1,t.unlock()},destroy:function(){var e=this,n=e.eventNS;e.trigger("destroy"),e.off(),e.$wrapper.remove(),e.$dropdown.remove(),e.$input.show(),t(window).off(n),t(document).off(n),t(document.body).off(n),delete e.$input[0].selectize},render:function(t,e){var n,i,o="",s=!1,r=this,a=/^[\t ]*<([a-z][a-z0-9\-_]*(?:\:[a-z][a-z0-9\-_]*)?)/i;return("option"===t||"item"===t)&&(n=b(e[r.settings.valueField]),s=!!n),s&&(C(r.renderCache[t])||(r.renderCache[t]={}),r.renderCache[t].hasOwnProperty(n))?r.renderCache[t][n]:(o=r.settings.render[t].apply(this,[e,I]),("option"===t||"option_create"===t)&&(o=o.replace(a,"<$1 data-selectable")),"optgroup"===t&&(i=e[r.settings.optgroupValueField]||"",o=o.replace(a,'<$1 data-group="'+I(i)+'"')),("option"===t||"item"===t)&&(o=o.replace(a,'<$1 data-value="'+I(n||"")+'"')),s&&(r.renderCache[t][n]=o),o)}}),j.count=0,j.defaults={plugins:[],delimiter:",",persist:!0,diacritics:!0,create:!1,highlight:!0,openOnFocus:!0,maxOptions:1e3,maxItems:null,hideSelected:null,preload:!1,scrollDuration:60,loadThrottle:300,dataAttr:"data-data",optgroupField:"optgroup",sortField:"$order",sortDirection:"asc",valueField:"value",labelField:"text",optgroupLabelField:"label",optgroupValueField:"value",optgroupOrder:null,searchField:["text"],mode:null,wrapperClass:"selectize-control",inputClass:"selectize-input",dropdownClass:"selectize-dropdown",dropdownContentClass:"selectize-dropdown-content",dropdownParent:null,render:{}},t.fn.selectize=function(e){e=e||{};var n=t.fn.selectize.defaults,i=e.dataAttr||n.dataAttr,o=function(i,o){var s,r,a,l=t.trim(i.val()||"");if(l.length){for(a=l.split(e.delimiter||n.delimiter),s=0,r=a.length;r>s;s++)o.options[a[s]]={text:a[s],value:a[s]};o.items=a}},s=function(e,n){var o,s,r,a,l=0;n.maxItems=e.attr("multiple")?null:1;var u=function(t){var e=i&&t.attr(i);return"string"==typeof e&&e.length?JSON.parse(e):null},p=function(e,i){var o,s;e=t(e),o=e.attr("value")||"",o.length&&(s=u(e)||{text:e.text(),value:o,optgroup:i},s.$order=++l,n.options[o]=s,e.is(":selected")&&n.items.push(o))},c=function(e){var i,o,s=t("option",e);e=t(e);var r=e.attr("label");for(r&&r.length&&(n.optgroups[r]=u(e)||{label:r}),i=0,o=s.length;o>i;i++)p(s[i],r)};for(a=e.children(),o=0,s=a.length;s>o;o++)r=a[o].tagName.toLowerCase(),"optgroup"===r?c(a[o]):"option"===r&&p(a[o])};return this.each(function(){var i,r=t(this),a=r[0].tagName.toLowerCase(),l={placeholder:r.children('option[value=""]').text()||r.attr("placeholder"),options:{},optgroups:{},items:[]};"select"===a?s(r,l):o(r,l),i=new j(r,t.extend(!0,{},n,l,e)),r.data("selectize",i),r.addClass("selectized")})},t.fn.selectize.defaults=j.defaults,j.define("drag_drop",function(){if(!t.fn.sortable)throw new Error('The "drag_drop" plugin requires jQuery UI "sortable".');if("multi"===this.settings.mode){var e=this;this.setup=function(){var n=e.setup;return function(){n.apply(this,arguments);var i=this.$control.sortable({items:"[data-value]",forcePlaceholderSize:!0,start:function(t,e){e.placeholder.css("width",e.helper.css("width")),i.css({overflow:"visible"})},stop:function(){i.css({overflow:"hidden"});var n=this.$activeItems?this.$activeItems.slice():null,o=[];i.children("[data-value]").each(function(){o.push(t(this).attr("data-value"))}),e.setValue(o),e.setActiveItem(n)}})}}()}}),j.define("dropdown_header",function(e){var n=this;e=t.extend({title:"Untitled",headerClass:"selectize-dropdown-header",titleRowClass:"selectize-dropdown-header-title",labelClass:"selectize-dropdown-header-label",closeClass:"selectize-dropdown-header-close",html:function(t){return'<div class="'+t.headerClass+'"><div class="'+t.titleRowClass+'"><span class="'+t.labelClass+'">'+t.title+'</span><a href="javascript:void(0)" class="'+t.closeClass+'">&times;</a></div></div>'
}},e),n.setup=function(){var i=n.setup;return function(){i.apply(n,arguments),n.$dropdown_header=t(e.html(e)),n.$dropdown.prepend(n.$dropdown_header)}}()}),j.define("optgroup_columns",function(e){var n=this;e=t.extend({equalizeWidth:!0,equalizeHeight:!0},e),this.getAdjacentOption=function(e,n){var i=e.closest("[data-group]").find("[data-selectable]"),o=i.index(e)+n;return o>=0&&o<i.length?i.eq(o):t()},this.onKeyDown=function(){var t=n.onKeyDown;return function(e){var i,o,s,r;return!this.isOpen||e.keyCode!==u&&e.keyCode!==c?t.apply(this,arguments):(n.ignoreHover=!0,r=this.$activeOption.closest("[data-group]"),i=r.find("[data-selectable]").index(this.$activeOption),r=e.keyCode===u?r.prev("[data-group]"):r.next("[data-group]"),s=r.find("[data-selectable]"),o=s.eq(Math.min(s.length-1,i)),void(o.length&&this.setActiveOption(o)))}}();var i=function(){var i,o,s,r,a,l,u;if(u=t("[data-group]",n.$dropdown_content),o=u.length,o&&n.$dropdown_content.width()){if(e.equalizeHeight){for(s=0,i=0;o>i;i++)s=Math.max(s,u.eq(i).height());u.css({height:s})}e.equalizeWidth&&(l=n.$dropdown_content.innerWidth(),r=Math.round(l/o),u.css({width:r}),o>1&&(a=l-r*(o-1),u.eq(o-1).css({width:a})))}};(e.equalizeHeight||e.equalizeWidth)&&(x.after(this,"positionDropdown",i),x.after(this,"refreshOptions",i))}),j.define("remove_button",function(e){if("single"!==this.settings.mode){e=t.extend({label:"&times;",title:"Remove",className:"remove",append:!0},e);var n=this,i='<a href="javascript:void(0)" class="'+e.className+'" tabindex="-1" title="'+I(e.title)+'">'+e.label+"</a>",o=function(t,e){var n=t.search(/(<\/[^>]+>\s*)$/);return t.substring(0,n)+e+t.substring(n)};this.setup=function(){var s=n.setup;return function(){if(e.append){var r=n.settings.render.item;n.settings.render.item=function(){return o(r.apply(this,arguments),i)}}s.apply(this,arguments),this.$control.on("click","."+e.className,function(e){e.preventDefault();var i=t(e.target).parent();n.setActiveItem(i),n.deleteSelection()&&n.setCaret(n.items.length)})}}()}}),j.define("restore_on_backspace",function(t){var e=this;t.text=t.text||function(t){return t[this.settings.labelField]},this.onKeyDown=function(){var n=e.onKeyDown;return function(e){var i,o;return e.keyCode===h&&""===this.$control_input.val()&&!this.$activeItems.length&&(i=this.caretPos-1,i>=0&&i<this.items.length)?(o=this.options[this.items[i]],this.deleteSelection(e)&&(this.setTextboxValue(t.text.apply(this,[o])),this.refreshOptions(!0)),void e.preventDefault()):n.apply(this,arguments)}}()}),j});
